import csv

# Read CSV files
def read_csv_file(filename):
    with open(filename, 'r') as file:
        reader = csv.DictReader(file)
        data = [row for row in reader]
    return data

# Write CSV file
def write_csv_file(filename, data, fieldnames):
    with open(filename, 'w', newline='') as file:
        writer = csv.DictWriter(file, fieldnames=fieldnames)
        writer.writeheader()
        writer.writerows(data)

fs_data = read_csv_file('fs.csv')
mdm_data = read_csv_file('mdm.csv')
vm_data = read_csv_file('vm.csv')

# Combine the data
all_data = fs_data + mdm_data + vm_data

# Find matches and create combined data
combined_data = []
for row in all_data:
    match_found = False
    
    for combined_row in combined_data:
        if row['serialNumber'] == combined_row['serialNumber']:
            match_found = True
            combined_row.update(row)
            combined_row['Match Type'] = 'Serial Number'
            break
        elif row['assetTag'] == combined_row['assetTag']:
            match_found = True
            combined_row.update(row)
            combined_row['Match Type'] = 'Asset Tag'
            break
    
    if not match_found:
        row['Match Type'] = 'No Match'
        combined_data.append(row)

# Get all headers from the combined data
fieldnames = set()
for row in combined_data:
    fieldnames.update(row.keys())

# Write combined data to CSV
write_csv_file('combined.csv', combined_data, fieldnames)
