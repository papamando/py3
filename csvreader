import csv

# Read CSVs
def read_csv(filename):
    data = []
    with open(filename, 'r') as file:
        reader = csv.reader(file)
        headers = next(reader)
        for row in reader:
            data.append(dict(zip(headers, row)))
    return data

fs_data = read_csv('fs.csv')
mdm_data = read_csv('mdm.csv')
vmw_data = read_csv('vmw.csv')

combined_data = []

# Find matches based on 'serialNumber'
for data in [fs_data, mdm_data, vmw_data]:
    for row in data[:]:
        matched = False
        for other_data in [fs_data, mdm_data, vmw_data]:
            if data == other_data:
                continue
            for other_row in other_data[:]:
                if row['serialNumber'] == other_row['serialNumber']:
                    matched = True
                    row.update(other_row)
                    row['matchType'] = 'Serial Number'
                    combined_data.append(row)
                    data.remove(row)
                    other_data.remove(other_row)
                    break
            if matched:
                break

# Find matches based on 'assetTag'
for data in [fs_data, mdm_data, vmw_data]:
    for row in data[:]:
        matched = False
        for other_data in [fs_data, mdm_data, vmw_data]:
            if data == other_data:
                continue
            for other_row in other_data[:]:
                if row['assetTag'] == other_row['assetTag']:
                    matched = True
                    row.update(other_row)
                    row['matchType'] = 'Asset Tag'
                    combined_data.append(row)
                    data.remove(row)
                    other_data.remove(other_row)
                    break
            if matched:
                break

# Append remaining rows with 'No Match'
for data in [fs_data, mdm_data, vmw_data]:
    for row in data:
        row['matchType'] = 'No Match'
        combined_data.append(row)

# Write to combined.csv
headers = set()
for row in combined_data:
    headers.update(row.keys())

with open('combined.csv', 'w', newline='') as file:
    writer = csv.DictWriter(file, fieldnames=headers)
    writer.writeheader()
    for row in combined_data:
        writer.writerow(row)
